apiVersion: v1
kind: Secret
metadata:
  name: {{ include "outline.fullname" . }}-secret
  labels:
    {{- include "outline.labels" . | nindent 4 }}
type: Opaque
data:
  # follows bitnami's autogeneration of keys.
  # autogenerated keys won't work by experience.
  {{/*
  SECRET_KEY: {{ include "common.secrets.passwords.manage" (dict "secret" (printf "%s-secret" (include "common.names.fullname" .)) "key" "SECRET_KEY" "providedValues" (list "secretKey") "length" 32 "context" $) }}
  UTILS_SECRET: {{ include "common.secrets.passwords.manage" (dict "secret" (printf "%s-secret" (include "common.names.fullname" .)) "key" "UTILS_SECRET" "providedValues" (list "utilsSecret") "length" 32 "context" $) }}
  */}}
  SECRET_KEY: {{ required ".Values.secretKey is required. generate it with `openssl rand -hex 32`" .Values.secretKey | b64enc | quote }}
  UTILS_SECRET: {{ required ".Values.utilsSecret is required. generate it with `openssl rand -hex 32`" .Values.utilsSecret | b64enc | quote }}

  # auth related secrets
  {{ include "outline.utils.secret_if" (list "SLACK_CLIENT_ID" (.Values.auth).slackClientId) }}
  {{ include "outline.utils.secret_if" (list "SLACK_CLIENT_SECRET" (.Values.auth).slackClientSecret) }}
  
  {{ include "outline.utils.secret_if" (list "GOOGLE_CLIENT_ID" (.Values.auth).googleClientId) }}
  {{ include "outline.utils.secret_if" (list "GOOGLE_CLIENT_SECRET" (.Values.auth).googleClientSecret) }}

  {{ include "outline.utils.secret_if" (list "AZURE_CLIENT_ID" (.Values.auth).azureClientId) }}
  {{ include "outline.utils.secret_if" (list "AZURE_CLIENT_SECRET" (.Values.auth).azureClientSecret) }}
  {{ include "outline.utils.secret_if" (list "AZURE_RESOURCE_APP_ID" (.Values.auth).azureResourceAppId) }}

  {{ include "outline.utils.secret_if" (list "OIDC_CLIENT_ID" (.Values.auth).oidcClientId) }}
  {{ include "outline.utils.secret_if" (list "OIDC_CLIENT_SECRET" (.Values.auth).oidcClientSecret) }}
  {{ include "outline.utils.secret_if" (list "OIDC_AUTH_URI" (.Values.auth).oidcAuthUri) }}
  {{ include "outline.utils.secret_if" (list "OIDC_TOKEN_URI" (.Values.auth).oidcTokenUri) }}
  {{ include "outline.utils.secret_if" (list "OIDC_USERINFO_URI" (.Values.auth).oidcUserinfoUri) }}
  
